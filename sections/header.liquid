<link rel="stylesheet" href="{{ 'component-list-menu.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-search.css' | asset_url }}" media="print" onload="this.media='all'">
<link rel="stylesheet" href="{{ 'component-menu-drawer.css' | asset_url }}" media="print" onload="this.media='all'">
<link
  rel="stylesheet"
  href="{{ 'component-cart-notification.css' | asset_url }}"
  media="print"
  onload="this.media='all'"
>

{%- if settings.predictive_search_enabled -%}
  <link rel="stylesheet" href="{{ 'component-price.css' | asset_url }}" media="print" onload="this.media='all'">
{%- endif -%}

{%- if section.settings.menu_type_desktop == 'mega' -%}
  <link rel="stylesheet" href="{{ 'component-mega-menu.css' | asset_url }}" media="print" onload="this.media='all'">
{%- endif -%}

<!-- Include Lottie library in the head -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js" defer></script>

<style>
  /* Loading overlay styles for cart drawer */
  .cart-drawer__loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 12; /* Higher than other elements */
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.2s ease, visibility 0.2s ease;
    pointer-events: all; /* Blocks interaction */
  }

  .cart-drawer__loading-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .cart-drawer__loading-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
  }

  .cart-drawer__spinner {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 4px solid rgba(0, 0, 0, 0.1);
    border-top-color: #000;
    animation: cart-spinner 0.8s linear infinite;
  }

  .cart-drawer__loading-text {
    font-size: 14px;
    color: #333;
    font-weight: 500;
    letter-spacing: 0.5px;
  }

  @keyframes cart-spinner {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Cart Drawer Styles */
  .cart-drawer {
    position: fixed;
    top: 0;
    right: 0;
    width: 400px;
    height: 100vh;
    background-color: #ffffff;
    z-index: 9999;
    transform: translateX(100%) scale(0.95);
    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: -5px 0 25px rgba(0, 0, 0, 0.15);
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .cart-drawer.active {
    transform: translateX(0) scale(1);
  }

  .cart-drawer__overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 9995;
    opacity: 0;
    visibility: hidden;
    display: none;
    transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    cursor: pointer;
  }

  .cart-drawer__overlay.active {
    opacity: 1;
    visibility: visible;
    display: block;
    pointer-events: all;
  }

  .cart-drawer__header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid #f1f1f1;
    background-color: #fbfbfb;
  }

  .cart-drawer__title {
    font-size: 18px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin: 0;
    color: #333;
  }

  .cart-drawer__close {
    background: transparent;
    border: none;
    padding: 8px;
    cursor: pointer;
    color: #777;
    transition: color 0.2s ease, transform 0.2s ease;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .cart-drawer__close:hover {
    color: #333;
    transform: rotate(90deg);
    background-color: #f0f0f0;
  }

  .cart-drawer__close-icon {
    width: 20px;
    height: 20px;
  }

  .cart-drawer__content {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    scroll-behavior: smooth;
  }

  .cart-drawer__items {
    margin-bottom: 30px;
  }

  .cart-drawer__item {
    display: grid;
    grid-template-columns: 80px 1fr auto;
    grid-gap: 15px;
    padding: 15px 0;
    border-bottom: 1px solid #f1f1f1;
    animation: fade-in 0.3s ease-out;
    position: relative;
  }

  @keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .cart-drawer__item-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    background-color: #f7f7f7;
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: transform 0.2s ease;
  }

  .cart-drawer__item-image:hover {
    transform: scale(1.05);
  }

  .cart-drawer__item-details {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .cart-drawer__item-title {
    font-size: 14px;
    font-weight: 500;
    margin-bottom: 5px;
    color: #333;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .cart-drawer__item-variant {
    font-size: 12px;
    color: #777;
    margin-bottom: 5px;
  }

  .cart-drawer__item-price {
    font-size: 14px;
    font-weight: 600;
    color: #333;
  }

  .cart-drawer__item-quantity {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
    background-color: #f7f7f7;
    border-radius: 20px;
    padding: 3px;
    width: fit-content;
  }

  .cart-drawer__item-quantity-button {
    width: 28px;
    height: 28px;
    background-color: #fff;
    border: none;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
    font-size: 16px;
    line-height: 1;
    color: #333;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .cart-drawer__item-quantity-button:hover {
    background-color: #f0f0f0;
  }

  .cart-drawer__item-quantity-button:active {
    transform: scale(0.95);
  }

  .cart-drawer__item-quantity-input {
    width: 24px;
    text-align: center;
    border: none;
    background: transparent;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    -moz-appearance: textfield;
  }

  .cart-drawer__item-quantity-input::-webkit-outer-spin-button,
  .cart-drawer__item-quantity-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  .cart-drawer__item-remove {
    background: transparent;
    border: none;
    color: #999;
    font-size: 12px;
    text-decoration: none;
    cursor: pointer;
    padding: 5px 8px;
    margin-top: 8px;
    transition: color 0.2s ease, background-color 0.2s ease;
    border-radius: 4px;
    display: flex;
    align-items: center;
    width: fit-content;
  }

  .cart-drawer__item-remove:hover {
    color: #d9534f;
    background-color: #f8f8f8;
  }

  .cart-drawer__item-remove-icon {
    width: 12px;
    height: 12px;
    margin-right: 4px;
  }

  .cart-drawer__footer {
    padding: 20px;
    border-top: 1px solid #f1f1f1;
    background-color: #fff;
    box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.05);
  }

  .cart-drawer__subtotal {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    font-size: 16px;
    font-weight: 500;
    padding-bottom: 15px;
    border-bottom: 1px solid #f1f1f1;
  }

  .cart-drawer__subtotal-label {
    text-transform: uppercase;
    letter-spacing: 1px;
    color: #505050;
  }

  .cart-drawer__subtotal-value {
    font-weight: 600;
    font-size: 18px;
  }

  .cart-drawer__actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .cart-drawer__checkout-button {
    display: block;
    width: 100%;
    padding: 15px;
    background-color: #000;
    color: #fff;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.2s ease, transform 0.1s ease;
    font-size: 14px;
  }

  .cart-drawer__checkout-button:hover {
    background-color: #333;
  }

  .cart-drawer__checkout-button:active {
    transform: translateY(1px);
  }

  .cart-drawer__continue-shopping {
    display: block;
    width: 100%;
    padding: 15px;
    background-color: transparent;
    color: #000;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
    border: 1px solid #ddd;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 0;
    transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
    font-size: 14px;
  }

  .cart-drawer__continue-shopping:hover {
    background-color: #f5f5f5;
    border-color: #ccc;
  }

  .cart-drawer__continue-shopping:active {
    transform: translateY(1px);
  }

  .cart-drawer__footer-info {
    margin-top: 15px;
    font-size: 12px;
    color: #777;
    text-align: center;
    padding-top: 15px;
    border-top: 1px solid #f1f1f1;
  }

  .cart-drawer__shipping-message {
    margin-bottom: 5px;
  }

  .cart-drawer__secure-checkout {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 5px;
  }

  .cart-drawer__secure-icon {
    width: 12px;
    height: 12px;
  }

  /* Success animation for checkout button */
  @keyframes success-pulse {
    0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
    70% { box-shadow: 0 0 0 10px rgba(40, 167, 69, 0); }
    100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
  }

  .cart-drawer__checkout-button--highlight {
    animation: success-pulse 1.5s ease-out;
    background-color: #28a745;
  }

  /* Empty cart illustration styles */
  .cart-drawer__empty-illustration {
    width: 120px;
    height: 120px;
    margin-bottom: 20px;
    opacity: 0.7;
  }

  .cart-drawer__empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 40px 20px;
    height: 100%;
  }

  .cart-drawer__empty-icon {
    width: 60px;
    height: 60px;
    margin-bottom: 20px;
    opacity: 0.3;
  }

  .cart-drawer__empty-message {
    font-size: 18px;
    font-weight: 500;
    margin-bottom: 10px;
    color: #333;
  }

  .cart-drawer__empty-submessage {
    font-size: 14px;
    margin-bottom: 25px;
    color: #777;
    max-width: 250px;
    line-height: 1.5;
  }

  .cart-drawer__add-animation {
    animation: zoom-pulse 0.5s ease-out;
  }

  @keyframes zoom-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  @media screen and (max-width: 749px) {
    .cart-drawer {
      width: 90vw;
    }

    .cart-drawer__overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 100vh;
    }
  }

  header-drawer {
    justify-self: start;
    margin-left: -1.2rem;
  }

  {%- if section.settings.sticky_header_type == 'reduce-logo-size' -%}
    .scrolled-past-header .header__heading-logo-wrapper {
      width: 75%;
    }
  {%- endif -%}

  {%- if section.settings.menu_type_desktop != "drawer" -%}
    @media screen and (min-width: 990px) {
      header-drawer {
        display: none;
      }
    }
  {%- endif -%}

  .menu-drawer-container {
    display: flex;
  }

  .list-menu {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .list-menu--inline {
    display: inline-flex;
    flex-wrap: wrap;
  }

  summary.list-menu__item {
    padding-right: 2.7rem;
  }

  .list-menu__item {
    display: flex;
    align-items: center;
    line-height: calc(1 + 0.3 / var(--font-body-scale));
  }

  .list-menu__item--link {
    text-decoration: none;
    padding-bottom: 1rem;
    padding-top: 1rem;
    line-height: calc(1 + 0.8 / var(--font-body-scale));
  }

  @media screen and (min-width: 750px) {
    .list-menu__item--link {
      padding-bottom: 0.5rem;
      padding-top: 0.5rem;
    }
  }

  .header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 60px;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    max-width: 100vw;
    z-index: 100;
    transition: background-color 0.3s ease, padding 0.3s ease;
    background: transparent;
  }

  .header--scrolled {
    background-color: rgba(0, 0, 0, 0.92);
    padding: 15px 60px;
  }

  .header__left,
  .header__center,
  .header__right {
    display: flex;
    align-items: center;
  }

  .header__left,
  .header__right {
    flex: 1;
  }

  .header__center {
    flex: 2;
    justify-content: center;
  }

  .header__right {
    min-width: 80px; /* Give the right section a minimum width to balance the header */
    justify-content: flex-end;
    flex: 1;
    display: flex;
    align-items: center;
  }

  .header__menu-button {
    background: transparent;
    border: none;
    padding: 10px;
    cursor: pointer;
    color: white;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: opacity 0.3s ease;
    font-family: 'Helvetica Neue', sans-serif;
    position: relative;
    z-index: 1001;
  }

  .header__menu-button:hover {
    opacity: 0.8;
  }

  .header__menu-icon {
    width: 24px;
    height: 24px;
  }

  .header__menu-text {
    font-size: 14px;
    font-weight: 300;
    letter-spacing: 1px;
    text-transform: uppercase;
  }

  .header__logo {
    font-size: 28px;
    font-weight: 200;
    color: white;
    text-decoration: none;
    letter-spacing: 1px;
    font-family: 'Helvetica Neue', sans-serif;
  }

  /* Enhanced Header Icons - Common Styles */
  .header__icon-link,
  #cart-icon-bubble {
    position: relative;
    border: none;
    background: transparent;
    padding: 8px;
    cursor: pointer;
    border-radius: 50%;
    transition: transform 0.15s ease, background-color 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 20px;
    /* Remove overflow: hidden to allow the badge to be fully visible */
  }

  .header__icon-link:hover,
  #cart-icon-bubble:hover {
    transform: translateY(-2px);
    background-color: rgba(255, 255, 255, 0.15);
  }

  .header__icon-link:active,
  #cart-icon-bubble:active {
    transform: translateY(0);
  }

  .header__icon-link .header__icon,
  #cart-icon-bubble .header__icon {
    transition: transform 0.3s ease;
    width: 22px;
    height: 22px;
  }

  .header__icon-link:hover .header__icon,
  #cart-icon-bubble:hover .header__icon {
    transform: scale(1.1);
  }

  /* Improved Cart Count Badge */
  .cart-count-bubble {
    position: absolute;
    top: 0;
    right: 0;
    background-color: #ff3333;
    color: white;
    font-size: 10px;
    font-weight: 700;
    min-width: 16px;
    height: 16px;
    border-radius: 10px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-family: 'Helvetica Neue', sans-serif;
    padding: 0 4px;
    letter-spacing: -0.5px;
    box-sizing: border-box;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    animation: cart-bubble-pulse 0.5s ease-out;
    transform: translate(40%, -30%); /* Adjust position to ensure it's visible */
    border: 1.5px solid white;
    z-index: 5; /* Ensure it stays on top */
  }

  /* Ripple effect for header icons */
  @keyframes ripple {
    0% {
      transform: translate(-50%, -50%) scale(0);
      opacity: 0.5;
    }
    100% {
      transform: translate(-50%, -50%) scale(3);
      opacity: 0;
    }
  }

  .cart-icon-ripple {
    position: fixed; /* Use fixed positioning to avoid overflow issues */
    width: 20px;
    height: 20px;
    background-color: rgba(255, 255, 255, 0.4);
    border-radius: 50%;
    pointer-events: none; /* Don't interfere with clicks */
    animation: ripple 0.6s ease-out;
    z-index: 100; /* Ensure it stays above other content */
  }

  @keyframes cart-bubble-pulse {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
  }

  .header__icon-link {
    color: white;
    text-decoration: none;
    margin-left: 20px;
    transition: opacity 0.3s ease;
    position: relative;
  }

  .header__icon-link--mobile-search {
    display: none; /* Hidden by default */
    margin-left: 15px; /* Smaller margin between menu and search */
  }

  .header__icon-link:hover {
    opacity: 0.8;
  }

  @media screen and (max-width: 749px) {
    .header {
      padding: 4px 25px !important; /* Slightly reduced side padding */
    }

    .header--scrolled {
      padding: 0px 20px; /* Consistent with reduced padding */
    }

    .header__menu-button {
      padding: 8px 0 8px 8px; /* Adjust padding for better mobile alignment */
    }

    .header__icon-link--mobile-search {
      display: flex; /* Show on mobile */
      margin-left: 10px; /* Smaller margin between menu and search */
    }

    .header__icon-link--desktop-search {
      display: none; /* Hide on mobile */
    }

    .header__left {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      min-width: 80px; /* Give the left section a minimum width */
      flex: 1;
    }

    .header__right {
      min-width: 80px; /* Give the right section a minimum width to balance the header */
      justify-content: flex-end;
      flex: 1;
    }

    .header__center {
      flex: 2; /* Balance the center section */
      justify-content: center;
      margin: 0 auto;
    }

    .header__heading-logo-wrapper {
      margin: 0 auto;
    }

    .header__logo {
      font-size: 22px;
      display: flex;
      justify-content: center;
      width: 100%;
    }

    .header__heading-logo-wrapper {
    max-width: 100%;
    display: block;
    width: {{ settings.logo_width }}px;
  }
  /* Extra small mobile adjustments */
  @media screen and (max-width: 370px) {
    .header__icon-link,
    #cart-icon-bubble {
      margin-left: 8px;
      padding: 5px;
    }

    .header__icon-link .header__icon,
    #cart-icon-bubble .header__icon {
      width: 18px;
      height: 18px;
    }
  }
      margin: 0 auto;
    }

    .header__icon-link {
      margin-left: 15px;
    }

    .header__icon {
      width: 20px;
      height: 20px;
    }
  }

  .header__icon {
    color: rgba(var(--color-foreground));
    height: 4.4rem;
    display: flex;
    align-items: center;
  }

  @media screen and (max-width: 990px) {
    .header {
      padding: 8px 25px;
    }

    .header--scrolled {
      padding: 6px 25px;
    }

    .header__menu-text {
      display: none;
    }

    .header__logo {
      font-size: 24px;
    }

    .header__icon {
      width: 22px;
      height: 22px;
    }
  }

  /* Mobile adjustments for header icons */
  @media screen and (max-width: 749px) {
    .header__logo {
      font-size: 22px;
    }

    .header__icon-link,
    #cart-icon-bubble {
      margin-left: 10px;
      padding: 6px;
    }

    .header__icon-link .header__icon,
    #cart-icon-bubble .header__icon {
      width: 20px;
      height: 20px;
    }

    .cart-count-bubble {
      min-width: 14px;
      height: 14px;
      font-size: 9px;
      transform: translate(30%, -30%);
      border-width: 1px;
    }
  }

  /* Extra small mobile adjustments */
  @media screen and (max-width: 370px) {
    .header__icon-link,
    #cart-icon-bubble {
      margin-left: 8px;
      padding: 5px;
    }

    .header__icon-link .header__icon,
    #cart-icon-bubble .header__icon {
      width: 18px;
      height: 18px;
    }
  }

  .header__heading-logo {
    display: block;
    width: 100%;
    height: auto;
  }

  .header__icons {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .header__icon {
    color: rgba(var(--color-foreground));
    height: 4.4rem;
    display: flex;
    align-items: center;
  }

  .section-header {
    position: sticky; /* This is for fixing a Safari z-index issue */
    margin-bottom: -10px; /*{{ section.settings.margin_bottom | times: 0.75 | round: 0 }}px;*/
  }

  @media screen and (min-width: 750px) {
    .section-header {
      margin-bottom: {{ section.settings.margin_bottom }}px;
    }

    .header__right-section {
      gap: 0.5rem;
    }

  }

  @media screen and (min-width: 990px) {
    .header {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Body overflow control */
  body {
    overflow-x: hidden;
    position: relative;
    z-index: 0;
  }

  /* Header width control */
  .header-wrapper {
    position: absolute;
    width: 100%;
    max-width: 100vw;
    z-index: 10;
    transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
  }

  /* Default transparent background but with text colored according to the scheme */
  .header-wrapper--transparent {
    background: transparent !important;
    border-bottom: none !important;
  }

  /* Scrolled header styles - fixed position with background */
  .header-wrapper.scrolled-past-header {
    position: fixed;
    top: 0;
    background: rgba(var(--color-background)) !important;
    border-bottom: 1px solid rgba(var(--color-foreground), 0.08) !important;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  /* Add these styles for non-home pages */
  .header-wrapper--not-home {
    position: relative;
    margin-bottom: 50px;
  }

  .header-wrapper--not-home .header {
    background: rgba(var(--color-background));
  }

  .header {
    background: transparent;
    transition: background-color 0.3s ease;
    max-width: 100vw;
  }

  /* Text color based on color scheme */
  .header *, .header__icon {
    color: rgba(var(--color-foreground));
    transition: color 0.3s ease, text-shadow 0.3s ease;
  }

  /* For transparent header on dark backgrounds, add option to force light text */
  .header-wrapper--transparent:not(.header-wrapper--scrolled) .header *,
  .header-wrapper--transparent:not(.header-wrapper--scrolled) .header__icon {
    color: #ffffff;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }

  /* Reset text-shadow when scrolled */
  .scrolled-past-header .header *,
  .scrolled-past-header .header__icon,
  .header-wrapper--scrolled .header *,
  .header-wrapper--scrolled .header__icon {
    text-shadow: none;
    /* This ensures scrolled header uses the color scheme foreground color */
    color: rgba(var(--color-foreground));
  }

  /* Logo and Lottie animation container styles */
  .header__heading-logo-container {
    position: relative;
    width: 100%;
    height: 100%;
  }

  /* Regular logo */
  .header__heading-logo-wrapper {
    max-width: 100%;
    display: block;
    width: {{ settings.logo_width }}px;
    transition: opacity 0.3s ease;
  }

  /* Lottie animation container */
  .header__heading-logo-animation {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    /* We'll set a size directly instead of using transform scale */
    transform: none;
    transform-origin: center center;
  }

  /* Target the SVG that Lottie creates inside the animation container */
  .header__heading-logo-animation svg {
    height: 90px !important;
    width: auto !important;
  }

  /* Responsive handling is still needed for proper positioning */
  @media screen and (max-width: 749px) {
    .header__heading-logo-animation {
      /* Center alignment adjustments for mobile */
      justify-content: center;
    }
  }

  @media screen and (min-width: 750px) and (max-width: 989px) {
    .header__heading-logo-animation {
      /* Center alignment for tablets */
      justify-content: center;
    }
  }

  @media screen and (min-width: 990px) {
    .header__heading-logo-animation {
      /* Center alignment for desktop */
      justify-content: center;
    }
  }

  /* When scrolled, hide the regular logo and show the animation */
  .scrolled-past-header .header__heading-logo-wrapper {
    opacity: 0;
  }

  .scrolled-past-header .header__heading-logo-animation {
    opacity: 1;
  }

  /* For header--scrolled class (used by our JavaScript) */
  .header--scrolled .header__heading-logo-wrapper {
    opacity: 0;
  }

  .header--scrolled .header__heading-logo-animation {
    opacity: 1;
  }

  /* Fullscreen Menu Styles */
  .fullscreen-menu {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background-color: #ffffff;
    z-index: 1000;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.5s ease, visibility 0.5s ease;
    overflow: auto; /* Enable scrolling */
  }

  .fullscreen-menu--open {
    opacity: 1;
    visibility: visible;
  }

  .fullscreen-menu__inner {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 50px 50px; /* Further reduced from 60px */
    box-sizing: border-box;
    overflow-y: auto;
  }

  .fullscreen-menu__content {
    display: flex;
    flex-direction: row;
    width: 100%;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
  }

  .fullscreen-menu__close-button {
    position: absolute;
    top: -40px;
    right: 0;
    background: transparent;
    border: none;
    padding: 10px;
    cursor: pointer;
    color: #000000;
    z-index: 10;
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  .fullscreen-menu__close-button:hover {
    opacity: 0.8;
    transform: rotate(90deg);
  }

  .fullscreen-menu__close-icon {
    width: 32px;
    height: 32px;
  }

  .fullscreen-menu__left {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding-right: 40px; /* Reduced from 60px */
  }

  .fullscreen-menu__right {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    align-items: flex-end;
    padding-left: 40px; /* Reduced from 60px */
  }

  .fullscreen-menu__shop-all {
    font-size: 14px;
    font-weight: 300;
    color: rgba(0, 0, 0, 0.6);
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 20px; /* Further reduced from 30px */
    font-family: 'Helvetica Neue', sans-serif;
  }

  .fullscreen-menu__category-list {
    list-style: none;
    padding: 0;
    margin: 0;
    max-height: 65vh; /* Increased from 60vh to show more content */
    overflow-y: auto;
  }

  .fullscreen-menu__category-item {
    margin-bottom: 12px; /* Further reduced from 16px */
    position: relative;
    overflow: hidden;
  }

  .fullscreen-menu__category-link {
    font-size: 32px; /* Reduced from 42px */
    font-weight: 200;
    color: #000000;
    text-decoration: none;
    text-transform: uppercase;
    transition: color 0.3s ease, transform 0.3s ease;
    display: inline-block;
    letter-spacing: 1px;
    font-family: 'Helvetica Neue', sans-serif;
    position: relative;
    padding-bottom: 3px;
  }

  .fullscreen-menu__category-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background-color: #000000;
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s ease;
  }

  .fullscreen-menu__category-link:hover {
    color: rgba(0, 0, 0, 0.7);
  }

  .fullscreen-menu__category-link:hover::after {
    transform: scaleX(1);
    transform-origin: left;
  }

  .fullscreen-menu__footer-links {
    display: flex;
    flex-direction: column;
    gap: 10px; /* Further reduced from 14px */
    margin-top: auto;
    padding-top: 30px; /* Reduced from 40px */
  }

  .fullscreen-menu__footer-link {
    font-size: 14px;
    color: rgba(0, 0, 0, 0.7);
    text-decoration: none;
    transition: color 0.3s ease, transform 0.3s ease;
    font-family: 'Helvetica Neue', sans-serif;
    position: relative;
    display: inline-block;
    padding-bottom: 2px;
  }

  .fullscreen-menu__footer-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background-color: rgba(0, 0, 0, 0.7);
    transform: scaleX(0);
    transform-origin: right;
    transition: transform 0.3s ease;
  }

  .fullscreen-menu__footer-link:hover {
    color: #000000;
  }

  .fullscreen-menu__footer-link:hover::after {
    transform: scaleX(1);
    transform-origin: left;
  }

  .fullscreen-menu__browse-more {
    font-size: 48px; /* Further reduced from 56px */
    font-weight: 200;
    color: #000000;
    margin-bottom: 30px; /* Further reduced from 40px */
    text-align: right;
    font-family: 'Helvetica Neue', sans-serif;
    letter-spacing: 1px;
    line-height: 1;
  }

  .fullscreen-menu__actions {
    margin-bottom: 40px; /* Further reduced from 60px */
    display: flex;
    justify-content: flex-end;
  }

  .fullscreen-menu__login-button {
    display: flex;
    align-items: center;
    background-color: transparent;
    color: #000000;
    text-decoration: none;
    padding: 12px 40px;
    border-radius: 0;
    font-weight: 300;
    transition: background-color 0.3s ease;
    font-family: 'Helvetica Neue', sans-serif;
    letter-spacing: 1px;
    border: 1px solid rgba(0, 0, 0, 0.3);
    font-size: 15px;
  }

  .fullscreen-menu__login-button:hover {
    background-color: rgba(0, 0, 0, 0.05);
  }

  .fullscreen-menu__login-arrow {
    width: 18px;
    height: 18px;
    margin-left: 12px;
    transition: transform 0.3s ease;
  }

  .fullscreen-menu__login-button:hover .fullscreen-menu__login-arrow {
    transform: translateX(5px);
  }

  .fullscreen-menu__locale {
    display: flex;
    gap: 15px;
  }

  .fullscreen-menu__locale-selector {
    position: relative;
  }

  .fullscreen-menu__selector-button {
    display: flex;
    align-items: center;
    background-color: transparent;
    border: 1px solid rgba(0, 0, 0, 0.15);
    border-radius: 0;
    color: rgba(0, 0, 0, 0.8);
    padding: 8px 16px;
    font-size: 13px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-family: 'Helvetica Neue', sans-serif;
    letter-spacing: 0.5px;
    font-weight: 300;
  }

  .fullscreen-menu__selector-button:hover {
    background-color: rgba(0, 0, 0, 0.05);
    color: #000000;
  }

  .fullscreen-menu__selector-arrow {
    width: 10px;
    height: 10px;
    margin-left: 8px;
    transition: transform 0.3s ease;
  }

  .fullscreen-menu__selector-button:hover .fullscreen-menu__selector-arrow {
    transform: translateY(2px);
  }

  /* Mobile styles */
  @media screen and (max-width: 749px) {
    .fullscreen-menu__inner {
      padding: 20px 20px; /* Further reduced from 30px 25px */
      justify-content: flex-start;
    }

    .fullscreen-menu__content {
      flex-direction: column;
    }

    .fullscreen-menu__left,
    .fullscreen-menu__right {
      padding: 0;
    }

    .fullscreen-menu__right {
      margin-top: 25px; /* Further reduced from 40px */
      align-items: flex-start;
    }

    .fullscreen-menu__browse-more {
      font-size: 32px; /* Further reduced from 36px */
      margin-bottom: 20px; /* Further reduced from 25px */
      text-align: left;
    }

    .fullscreen-menu__actions {
      margin-bottom: 20px; /* Further reduced from 30px */
      justify-content: flex-start;
    }

    .fullscreen-menu__category-list {
      max-height: 55vh; /* Increased from 50vh */
    }

    .fullscreen-menu__category-link {
      font-size: 24px; /* Further reduced from 28px */
    }

    .fullscreen-menu__close-button {
      top: -15px; /* Moved closer to top */
      right: -5px;
    }

    .fullscreen-menu__close-icon {
      width: 26px;
      height: 26px;
    }

    .fullscreen-menu__login-button {
      padding: 8px 20px; /* Reduced padding */
      font-size: 14px;
    }

    .fullscreen-menu__login-arrow {
      width: 16px;
      height: 16px;
    }

    .fullscreen-menu__shop-all {
      letter-spacing: 2px;
      margin-bottom: 20px; /* Further reduced from 30px */
    }

    .fullscreen-menu__footer-links {
      padding-top: 20px; /* Reduced from 30px */
      gap: 8px; /* Further reduced from mobile */
    }

    .fullscreen-menu__category-item {
      margin-bottom: 10px; /* Further reduced from 14px */
    }
  }

  /* Global styles */
  .overflow-hidden {
    overflow: hidden;
  }
</style>

<script src="{{ 'cart-notification.js' | asset_url }}" defer="defer"></script>

{%- liquid
  for block in section.blocks
    if block.type == '@app'
      assign has_app_block = true
    endif
  endfor
-%}

{% liquid
  assign header_tag = 'div'

  if section.settings.sticky_header_type != 'none'
    assign header_tag = 'sticky-header'
  endif
%}

<{{ header_tag }}
  {% if header_tag == 'sticky-header' %}
    data-sticky-type="{{ section.settings.sticky_header_type }}"
    data-scroll-color-scheme="{{ section.settings.scroll_color_scheme }}"
    data-transparent="{{ section.settings.transparent_header }}"
  {% endif %}
  class="
    header-wrapper color-{{ section.settings.color_scheme }} gradient
    {% if section.settings.show_line_separator %} header-wrapper--border-bottom{% endif %}
    {% if section.settings.transparent_header %} header-wrapper--transparent{% endif %}
    {% unless request.page_type == 'index' %} header-wrapper--not-home{% endunless %}
  "
>
  {%- liquid
    assign social_links = false
    assign localization_forms = false

    if settings.social_twitter_link != blank or settings.social_facebook_link != blank or settings.social_pinterest_link != blank or settings.social_instagram_link != blank or settings.social_youtube_link != blank or settings.social_vimeo_link != blank or settings.social_tiktok_link != blank or settings.social_tumblr_link != blank or settings.social_snapchat_link != blank
      assign social_links = true
    endif

    if localization.available_countries.size > 1 and section.settings.enable_country_selector or section.settings.enable_language_selector and localization.available_languages.size > 1
      assign localization_forms = true
    endif
  -%}
  <header
    class="header header--{{ section.settings.logo_position }} header--mobile-{{ section.settings.mobile_logo_position }} page-width{% if section.settings.menu_type_desktop == 'drawer' %} drawer-menu{% endif %}{% if section.settings.menu != blank %} header--has-menu{% endif %}{% if has_app_block %} header--has-app{% endif %}{% if social_links %} header--has-social{% endif %}{% if shop.customer_accounts_enabled %} header--has-account{% endif %}{% if localization_forms %} header--has-localizations{% endif %}"
    id="shopify-section-header"
  >
    <!-- Left Section - Menu Button -->
    <div class="header__left">
      <button
        type="button"
        class="header__menu-button"
        aria-expanded="false"
        aria-controls="fullscreen-menu"
        id="burger-menu-toggle"
      >
        <svg class="header__menu-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 12H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 18H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- Search Icon for Mobile - shown only on mobile -->
      <button
        type="button"
        class="header__icon-link header__icon-link--mobile-search"
        id="mobile-search-icon"
        aria-label="{{ 'general.search.search' | t }}"
        onclick="window.location.href='{{ routes.search_url }}'"
      >
        <svg class="header__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>

    <!-- Center Section - Logo -->
    <div class="header__center">
      {%- if request.page_type == 'index' -%}
        <h1 class="header__heading">
      {%- endif -%}
      <a href="{{ routes.root_url }}" class="header__logo">
        {%- if settings.logo != blank -%}
          <div class="header__heading-logo-container">
            <div class="header__heading-logo-wrapper">
              {%- assign logo_alt = settings.logo.alt | default: shop.name | escape -%}
              {%- assign logo_height = settings.logo_width | divided_by: settings.logo.aspect_ratio -%}
              {% capture sizes %}(max-width: {{ settings.logo_width | times: 2 }}px) 50vw, {{ settings.logo_width }}px{% endcapture %}
              {% capture widths %}{{ settings.logo_width }}, {{ settings.logo_width | times: 1.5 | round }}, {{ settings.logo_width | times: 2 }}{% endcapture %}
              {{
                settings.logo
                | image_url: width: 600
                | image_tag:
                  class: 'header__logo-image',
                  widths: widths,
                  height: logo_height,
                  width: settings.logo_width,
                  alt: logo_alt,
                  sizes: sizes,
                  preload: true
              }}
            </div>
            <!-- Lottie Animation Container -->
            <div id="header-logo-animation" class="header__heading-logo-animation"></div>
          </div>
        {%- else -%}
          <span>{{ shop.name }}</span>
        {%- endif -%}
      </a>
      {%- if request.page_type == 'index' -%}
        </h1>
      {%- endif -%}
    </div>

    <!-- Right Section - Icons -->
    <div class="header__right">
      <!-- Search Icon -->
      <button
        type="button"
        class="header__icon-link header__icon-link--desktop-search"
        id="search-icon"
        aria-label="{{ 'general.search.search' | t }}"
        onclick="window.location.href='{{ routes.search_url }}'"
      >
        <svg class="header__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>

      <!-- Account Icon -->
      {%- if shop.customer_accounts_enabled -%}
        <button
          type="button"
          class="header__icon-link"
          id="account-icon"
          aria-label="{{ 'customer.account_fallback' | t }}"
          onclick="window.location.href='{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}'"
        >
          <svg class="header__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      {%- endif -%}

      <!-- Cart Icon -->
      <button
        type="button"
        class="header__icon-link"
        id="cart-icon-bubble"
        aria-label="{{ 'templates.cart.cart' | t }}"
      >
        <svg class="header__icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {%- if cart != empty -%}
          <div class="cart-count-bubble">
            {%- if cart.item_count < 100 -%}
              <span aria-hidden="true">{{ cart.item_count }}</span>
            {%- endif -%}
            <span class="visually-hidden">{{ 'sections.header.cart_count' | t: count: cart.item_count }}</span>
          </div>
        {%- endif -%}
      </button>
    </div>
  </header>
</{{ header_tag }}>

<!-- Cart Drawer -->
<div id="cart-drawer-overlay" class="cart-drawer__overlay"></div>
<div id="cart-drawer" class="cart-drawer">
  <!-- Loading Overlay -->
  <div id="cart-drawer-loading" class="cart-drawer__loading-overlay">
    <div class="cart-drawer__loading-content">
      <div class="cart-drawer__spinner"></div>
      <div class="cart-drawer__loading-text">Updating your cart...</div>
    </div>
  </div>
  <div class="cart-drawer__header">
    <h2 class="cart-drawer__title">Your Cart</h2>
    <button id="cart-drawer-close" class="cart-drawer__close" aria-label="Close cart">
      <svg class="cart-drawer__close-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </div>

  <div id="cart-drawer-content" class="cart-drawer__content">
    <!-- Items container - shown when cart has items -->
    <div id="cart-drawer-items" class="cart-drawer__items"></div>

    <!-- Empty cart message - shown when cart is empty -->
    <div id="cart-drawer-empty" class="cart-drawer__empty">
      <svg class="cart-drawer__empty-illustration" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect width="100" height="100" rx="50" fill="#F5F5F5"/>
        <path d="M67 36H33C30.8 36 29 37.8 29 40V60C29 62.2 30.8 64 33 64H67C69.2 64 71 62.2 71 60V40C71 37.8 69.2 36 67 36Z" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M29 44H71" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M36 52H44" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <circle cx="50" cy="75" r="5" fill="#CCCCCC"/>
        <path d="M57 75C57 78.866 53.866 82 50 82C46.134 82 43 78.866 43 75" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M50 27V36" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M60 32L55 42" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M40 32L45 42" stroke="#9E9E9E" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <p class="cart-drawer__empty-message">Your shopping cart is empty</p>
      <p class="cart-drawer__empty-submessage">Add items to your cart to proceed with your purchase</p>
      <button class="cart-drawer__continue-shopping cart-empty-continue-shopping">Continue Shopping</button>
    </div>
  </div>

  <div class="cart-drawer__footer">
    <div class="cart-drawer__subtotal">
      <span class="cart-drawer__subtotal-label">Subtotal</span>
      <span id="cart-subtotal-value" class="cart-drawer__subtotal-value">$0.00</span>
    </div>

    <div class="cart-drawer__actions">
      <form action="{{ routes.cart_url }}" method="post" id="cart-drawer-checkout-form">
        <button type="submit" name="checkout" class="cart-drawer__checkout-button">Proceed to Checkout</button>
      </form>
      <button id="cart-continue-shopping" class="cart-drawer__continue-shopping">Continue Shopping</button>
    </div>

    <div class="cart-drawer__footer-info">
      <div class="cart-drawer__shipping-message">Shipping & taxes calculated at checkout</div>
      <div class="cart-drawer__secure-checkout">
        <svg class="cart-drawer__secure-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 11H5V21H19V11Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M17 9V7C17 4.23858 14.7614 2 12 2C9.23858 2 7 4.23858 7 7V9" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 16.5C12.8284 16.5 13.5 15.8284 13.5 15C13.5 14.1716 12.8284 13.5 12 13.5C11.1716 13.5 10.5 14.1716 10.5 15C10.5 15.8284 11.1716 16.5 12 16.5Z" fill="currentColor"/>
        </svg>
        <span>Secure checkout</span>
      </div>
    </div>
  </div>
</div>

<!-- Full-screen Menu Drawer -->
<div id="fullscreen-menu" class="fullscreen-menu">
  <div class="fullscreen-menu__inner">
    <div class="fullscreen-menu__content">
      <!-- Close Button -->
      <button
        id="fullscreen-menu-close"
        class="fullscreen-menu__close-button"
        aria-label="{{ 'accessibility.close' | t }}"
      >
        <svg class="fullscreen-menu__close-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="currentColor"/>
        </svg>
      </button>

      <!-- Left Side - Categories -->
      <div class="fullscreen-menu__left">
        <div class="fullscreen-menu__shop-all">SHOP ALL</div>

        <nav class="fullscreen-menu__nav">
          <ul class="fullscreen-menu__category-list">
            {%- if section.settings.menu != blank -%}
              {%- for link in section.settings.menu.links -%}
                <li class="fullscreen-menu__category-item">
                  <a href="{{ link.url }}" class="fullscreen-menu__category-link">
                    {{ link.title | escape }}
                  </a>
                </li>
              {%- endfor -%}
            {%- endif -%}
          </ul>
        </nav>

        <div class="fullscreen-menu__footer-links">
          <a href="{{ routes.page_url | append: '/about' }}" class="fullscreen-menu__footer-link">About</a>
          <a href="{{ routes.page_url | append: '/contact' }}" class="fullscreen-menu__footer-link">Contact Us</a>
          <a href="{{ routes.policies_url | append: '/privacy-policy' }}" class="fullscreen-menu__footer-link"
            >Privacy Policy</a
          >
        </div>
      </div>

      <!-- Right Side - Browse More & Login -->
      <div class="fullscreen-menu__right">
        <div class="fullscreen-menu__browse-more">Browse More</div>

        <div class="fullscreen-menu__actions">
          <a
            href="{%- if customer -%}{{ routes.account_url }}{%- else -%}{{ routes.account_login_url }}{%- endif -%}"
            class="fullscreen-menu__login-button"
          >
            Login
            <svg
              class="fullscreen-menu__login-arrow"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path d="M16.172 11L10.808 5.63605L12.222 4.22205L20 12L12.222 19.778L10.808 18.364L16.172 13H4V11H16.172Z" fill="currentColor"/>
            </svg>
          </a>
        </div>

        {% comment %}
          <div class="fullscreen-menu__locale">
            <div class="fullscreen-menu__locale-selector">
              <button class="fullscreen-menu__selector-button">
                Egypt
                <svg
                  class="fullscreen-menu__selector-arrow"
                  viewBox="0 0 12 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M6 8.5L2 4.5H10L6 8.5Z" fill="currentColor"/>
                </svg>
              </button>
            </div>

            <div class="fullscreen-menu__locale-selector">
              <button class="fullscreen-menu__selector-button">
                EGP
                <svg
                  class="fullscreen-menu__selector-arrow"
                  viewBox="0 0 12 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M6 8.5L2 4.5H10L6 8.5Z" fill="currentColor"/>
                </svg>
              </button>
            </div>

            <div class="fullscreen-menu__locale-selector">
              <button class="fullscreen-menu__selector-button">
                EN
                <svg
                  class="fullscreen-menu__selector-arrow"
                  viewBox="0 0 12 12"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path d="M6 8.5L2 4.5H10L6 8.5Z" fill="currentColor"/>
                </svg>
              </button>
            </div>
          </div>
        {% endcomment %}
      </div>
    </div>
  </div>
</div>

{%- if settings.cart_type == 'notification' -%}
  {%- render 'cart-notification', color_scheme: section.settings.color_scheme -%}
{%- endif -%}

{% schema %}
{
  "name": "t:sections.header.name",
  "class": "section-header",
  "max_blocks": 3,
  "settings": [
    {
      "type": "select",
      "id": "logo_position",
      "options": [
        {
          "value": "top-left",
          "label": "t:sections.header.settings.logo_position.options__2.label"
        },
        {
          "value": "top-center",
          "label": "t:sections.header.settings.logo_position.options__3.label"
        },
        {
          "value": "middle-left",
          "label": "t:sections.header.settings.logo_position.options__1.label"
        },
        {
          "value": "middle-center",
          "label": "t:sections.header.settings.logo_position.options__4.label"
        }
      ],
      "default": "middle-left",
      "label": "t:sections.header.settings.logo_position.label",
      "info": "t:sections.header.settings.logo_help.content"
    },
    {
      "type": "select",
      "id": "mobile_logo_position",
      "options": [
        {
          "value": "center",
          "label": "t:sections.header.settings.mobile_logo_position.options__1.label"
        },
        {
          "value": "left",
          "label": "t:sections.header.settings.mobile_logo_position.options__2.label"
        }
      ],
      "default": "center",
      "label": "t:sections.header.settings.mobile_logo_position.label"
    },
    {
      "type": "link_list",
      "id": "menu",
      "default": "main-menu",
      "label": "t:sections.header.settings.menu.label"
    },
    {
      "type": "select",
      "id": "menu_type_desktop",
      "options": [
        {
          "value": "dropdown",
          "label": "t:sections.header.settings.menu_type_desktop.options__1.label"
        },
        {
          "value": "mega",
          "label": "t:sections.header.settings.menu_type_desktop.options__2.label"
        },
        {
          "value": "drawer",
          "label": "t:sections.header.settings.menu_type_desktop.options__3.label"
        }
      ],
      "default": "dropdown",
      "label": "t:sections.header.settings.menu_type_desktop.label"
    },
    {
      "type": "select",
      "id": "sticky_header_type",
      "options": [
        {
          "value": "none",
          "label": "t:sections.header.settings.sticky_header_type.options__1.label"
        },
        {
          "value": "on-scroll-up",
          "label": "t:sections.header.settings.sticky_header_type.options__2.label"
        },
        {
          "value": "always",
          "label": "t:sections.header.settings.sticky_header_type.options__3.label"
        },
        {
          "value": "reduce-logo-size",
          "label": "t:sections.header.settings.sticky_header_type.options__4.label"
        }
      ],
      "default": "on-scroll-up",
      "label": "t:sections.header.settings.sticky_header_type.label"
    },
    {
      "type": "checkbox",
      "id": "show_line_separator",
      "default": true,
      "label": "t:sections.header.settings.show_line_separator.label"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__1.content"
    },
    {
      "type": "header",
      "content": "Color schemes"
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Default state color scheme",
      "info": "Applied when the header is at the top of the page (not scrolled)",
      "default": "scheme-1"
    },
    {
      "type": "color_scheme",
      "id": "scroll_color_scheme",
      "label": "Scrolled state color scheme",
      "info": "Applied when the user has scrolled down the page",
      "default": "scheme-1"
    },
    {
      "type": "color_scheme",
      "id": "menu_color_scheme",
      "label": "t:sections.header.settings.menu_color_scheme.label",
      "default": "scheme-1"
    },
    {
      "type": "header",
      "content": "t:sections.header.settings.header__utilities.content"
    },
    {
      "type": "checkbox",
      "id": "enable_country_selector",
      "default": true,
      "label": "t:sections.header.settings.enable_country_selector.label",
      "info": "t:sections.header.settings.enable_country_selector.info"
    },
    {
      "type": "checkbox",
      "id": "enable_language_selector",
      "default": true,
      "label": "t:sections.header.settings.enable_language_selector.label",
      "info": "t:sections.header.settings.enable_language_selector.info"
    },
    {
      "type": "checkbox",
      "id": "enable_customer_avatar",
      "default": true,
      "label": "t:sections.header.settings.enable_customer_avatar.label",
      "info": "t:sections.header.settings.enable_customer_avatar.info"
    },
    {
      "type": "header",
      "content": "t:sections.all.spacing"
    },
    {
      "type": "range",
      "id": "margin_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.header.settings.margin_bottom.label",
      "default": 0
    },
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 20
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 36,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 20
    },
    {
      "type": "checkbox",
      "id": "transparent_header",
      "default": true,
      "label": "Transparent header",
      "info": "Makes the header transparent with white text before scrolling. When scrolled, uses the selected color scheme."
    }
  ],
  "blocks": [
    {
      "type": "@app"
    }
  ]
}
{% endschema %}

<script>
  // Simple function to toggle the fullscreen menu
  function setupFullscreenMenu() {
    console.log('Setting up fullscreen menu');

    // Try multiple selectors to find the menu toggle button
    let menuToggle = document.querySelector('#burger-menu-toggle');
    if (!menuToggle) {
      console.log('Burger toggle not found by ID, trying class selector');
      menuToggle = document.querySelector('.header__menu-button');
    }

    const fullscreenMenu = document.getElementById('fullscreen-menu');
    const closeButton = document.getElementById('fullscreen-menu-close');

    console.log('Menu elements: ', {
      menuToggle: menuToggle ? true : false,
      fullscreenMenu: fullscreenMenu ? true : false,
      closeButton: closeButton ? true : false,
    });

    if (menuToggle && fullscreenMenu) {
      console.log('Adding click event to menu toggle');

      // Toggle menu when burger button is clicked
      menuToggle.onclick = function (event) {
        event.preventDefault();
        console.log('Menu toggle clicked');

        if (fullscreenMenu.classList.contains('fullscreen-menu--open')) {
          fullscreenMenu.classList.remove('fullscreen-menu--open');
          document.body.classList.remove('overflow-hidden');
          console.log('Menu closed');
        } else {
          fullscreenMenu.classList.add('fullscreen-menu--open');
          document.body.classList.add('overflow-hidden');
          console.log('Menu opened');
        }

        return false;
      };

      // Close menu when close button is clicked
      if (closeButton) {
        closeButton.onclick = function (event) {
          event.preventDefault();
          console.log('Close button clicked');
          fullscreenMenu.classList.remove('fullscreen-menu--open');
          document.body.classList.remove('overflow-hidden');
          return false;
        };
      }

      // Close menu when clicking on the overlay (background)
      fullscreenMenu.addEventListener('click', function (event) {
        // Get all the elements in the path from the click event to the top
        const path = event.composedPath();
        const clickedElement = event.target;

        // Check if click was on a background element, not on interactive elements
        const isBackgroundClick =
          // Direct click on fullscreen menu or its inner containers
          clickedElement === fullscreenMenu ||
          clickedElement.classList.contains('fullscreen-menu__inner') ||
          clickedElement.classList.contains('fullscreen-menu__content') ||
          // Check if click wasn't on an interactive element
          (!clickedElement.closest('a') &&
            !clickedElement.closest('button') &&
            !clickedElement.closest('input') &&
            !clickedElement.closest('.fullscreen-menu__category-item') &&
            !clickedElement.closest('.fullscreen-menu__locale-selector'));

        if (isBackgroundClick) {
          console.log('Background clicked, closing menu');
          fullscreenMenu.classList.remove('fullscreen-menu--open');
          document.body.classList.remove('overflow-hidden');
        }
      });

      // Make the toggle available globally for debugging
      window.toggleMenu = function () {
        console.log('Manual toggle');
        if (fullscreenMenu.classList.contains('fullscreen-menu--open')) {
          fullscreenMenu.classList.remove('fullscreen-menu--open');
          document.body.classList.remove('overflow-hidden');
        } else {
          fullscreenMenu.classList.add('fullscreen-menu--open');
          document.body.classList.add('overflow-hidden');
        }
      };
    } else {
      console.error('Could not find required elements for menu functionality');
    }
  }

  // Handle header scroll effect
  function setupHeaderScroll() {
    const header = document.getElementById('shopify-section-header');
    let headerAnimation = null;
    let hasAnimationPlayed = false;
    const animationPath = '/cdn/shop/t/4/assets/caldo91-logo-animation.json';

    // Initialize the animation when DOM is loaded
    if (typeof lottie !== 'undefined' && document.getElementById('header-logo-animation')) {
      const animationContainer = document.getElementById('header-logo-animation');

      // Check if the animation file exists
      fetch(animationPath, { method: 'HEAD' })
        .then((response) => {
          if (!response.ok) {
            console.warn('Header animation file not found, animation will not play');
            return;
          }

          // Animation file exists, proceed with loading
          // Clear any existing content
          animationContainer.innerHTML = '';

          // Load the animation but don't autoplay yet
          headerAnimation = lottie.loadAnimation({
            container: animationContainer,
            renderer: 'svg',
            loop: false, // Don't loop - play only once
            autoplay: false, // Don't autoplay on load
            path: animationPath,
            rendererSettings: {
              preserveAspectRatio: 'xMidYMid meet',
              clearCanvas: false,
              progressiveLoad: true,
              hideOnTransparent: true,
            },
          });

          // Set the SVG quality to high
          headerAnimation.setSubframe(false);

          // Add error handling for animation loading
          headerAnimation.addEventListener('data_failed', () => {
            console.error('Failed to load the logo animation file from:', animationPath);
          });

          // Apply fixed height to SVG after it's loaded
          headerAnimation.addEventListener('DOMLoaded', () => {
            // Get the SVG element that Lottie created
            const svg = animationContainer.querySelector('svg');
            if (svg) {
              // Set fixed height and preserve aspect ratio
              svg.setAttribute('height', '90px');
              svg.style.height = '90px';
              svg.style.width = 'auto';
            }
          });

          // Reset flag when animation completes
          headerAnimation.addEventListener('complete', () => {
            console.log('Header animation complete');
          });
        })
        .catch((error) => {
          console.error('Error checking animation file:', error);
        });
    }

    if (header) {
      window.addEventListener('scroll', function () {
        const isScrolled = window.scrollY > 50;

        if (isScrolled) {
          header.classList.add('header--scrolled');
          document.documentElement.classList.add('scrolled-past-header');

          // Play animation only if it hasn't been played yet in this scroll session
          if (headerAnimation && !hasAnimationPlayed) {
            headerAnimation.goToAndPlay(0, true);
            hasAnimationPlayed = true;
          }
        } else {
          header.classList.remove('header--scrolled');
          document.documentElement.classList.remove('scrolled-past-header');

          // Reset the animation flag when scrolled back to top
          hasAnimationPlayed = false;

          // Reset the animation to first frame when scrolled back up
          if (headerAnimation) {
            headerAnimation.goToAndStop(0, true);
          }
        }
      });
    }
  }

  // Initialize when the DOM is loaded
  document.addEventListener('DOMContentLoaded', function () {
    console.log('Initializing menu and header functionality');
    setupFullscreenMenu();
    setupHeaderScroll();

    // Listen for various add to cart events
    document.addEventListener('product:added', function () {
      if (window.openCartDrawer) {
        window.openCartDrawer(true);
      }
    });

    // Additionally listen for Shopify's add_to_cart event
    document.addEventListener('add_to_cart', function () {
      if (window.openCartDrawer) {
        window.openCartDrawer(true);
      }
    });

    // Safely check for jQuery and use it if available
    if (typeof jQuery !== 'undefined') {
      jQuery(document).on('cart.requestComplete', function (event, cart) {
        if (window.openCartDrawer) {
          window.openCartDrawer(true);
        }
      });
    }
    setupCartUpdates();

    // Ensure Lottie is loaded
    if (typeof lottie === 'undefined') {
      console.warn('Lottie library not loaded, attempting to load it');
      const script = document.createElement('script');
      script.src = 'https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.9.6/lottie.min.js';
      script.onload = function () {
        console.log('Lottie library loaded dynamically');
        setupHeaderScroll(); // Re-initialize header scroll to set up animation
      };
      document.head.appendChild(script);
    }
  });

  // Setup cart update handlers
  function setupCartUpdates() {
    // References to cart drawer elements
    const cartDrawer = document.getElementById('cart-drawer');
    const cartDrawerOverlay = document.getElementById('cart-drawer-overlay');
    const cartCloseButton = document.getElementById('cart-drawer-close');
    const cartLoadingOverlay = document.getElementById('cart-drawer-loading');

    // Function to show loading overlay
    function showCartLoading() {
      if (cartLoadingOverlay) {
        cartLoadingOverlay.classList.add('active');
      }
    }

    // Function to hide loading overlay
    function hideCartLoading() {
      if (cartLoadingOverlay) {
        cartLoadingOverlay.classList.remove('active');
      }
    }

    // Function to highlight checkout button when a new item is added
    function highlightCheckoutButton() {
      const checkoutButton = document.querySelector('.cart-drawer__checkout-button');
      if (checkoutButton) {
        checkoutButton.classList.add('cart-drawer__checkout-button--highlight');

        // Remove the class after animation completes
        setTimeout(() => {
          checkoutButton.classList.remove('cart-drawer__checkout-button--highlight');
        }, 2000);
      }
    }
    const cartContinueShopping = document.getElementById('cart-continue-shopping');
    const cartIconButton = document.getElementById('cart-icon-bubble');

    // Open cart drawer when clicking the cart icon
    if (cartIconButton) {
      // Add ripple effect to all header icons
      document.querySelectorAll('.header__icon-link, #cart-icon-bubble').forEach((icon) => {
        icon.addEventListener('click', function (e) {
          // Create ripple at mouse position
          const ripple = document.createElement('span');
          ripple.className = 'cart-icon-ripple';
          ripple.style.left = `${e.clientX}px`;
          ripple.style.top = `${e.clientY}px`;
          document.body.appendChild(ripple);

          // Remove the ripple after animation completes
          setTimeout(() => {
            ripple.remove();
          }, 600);
        });
      });

      // Set up cart open functionality
      cartIconButton.addEventListener('click', function (e) {
        e.preventDefault();
        openCartDrawer();
      });
    }

    // Close cart drawer when clicking the close button
    if (cartCloseButton) {
      cartCloseButton.addEventListener('click', closeCartDrawer);
    }

    // Close cart drawer when clicking any continue shopping button
    const continueShoppingButtons = document.querySelectorAll('.cart-drawer__continue-shopping');
    continueShoppingButtons.forEach((button) => {
      button.addEventListener('click', closeCartDrawer);
    });

    // Close cart drawer when clicking the overlay (blurry background)
    if (cartDrawerOverlay) {
      cartDrawerOverlay.addEventListener('click', function (event) {
        // Only close if clicking directly on the overlay (not its children)
        if (event.target === this) {
          closeCartDrawer();
        }
      });
    }

    // Open cart drawer function
    function openCartDrawer(isNewItem = false) {
      if (cartDrawer && cartDrawerOverlay) {
        // Show and activate overlay first
        cartDrawerOverlay.style.display = 'block';
        // Force a reflow to ensure display takes effect before adding the active class
        void cartDrawerOverlay.offsetWidth;
        cartDrawerOverlay.classList.add('active');

        // Then activate drawer
        setTimeout(() => {
          cartDrawer.classList.add('active');
        }, 10);
        document.body.classList.add('overflow-hidden');

        // Update cart contents
        updateCartContents(isNewItem);

        // If this is a new item, highlight the checkout button
        if (isNewItem) {
          setTimeout(() => {
            highlightCheckoutButton();
          }, 400); // Wait for cart to slide in
        }

        console.log('Cart drawer opened, overlay activated');
      }
    }

    // Close cart drawer function
    function closeCartDrawer() {
      if (cartDrawer && cartDrawerOverlay) {
        // First close drawer
        cartDrawer.classList.remove('active');

        // Then remove overlay after drawer animation completes
        setTimeout(() => {
          cartDrawerOverlay.classList.remove('active');
          document.body.classList.remove('overflow-hidden');

          // Hide overlay after animation completes
          setTimeout(() => {
            cartDrawerOverlay.style.display = 'none';
          }, 400);
        }, 300);

        console.log('Cart drawer closed');
      }
    }

    // Update cart contents function
    function updateCartContents(isNewItem = false) {
      const cartContent = document.getElementById('cart-drawer-content');
      const cartItems = document.getElementById('cart-drawer-items');
      const cartEmpty = document.getElementById('cart-drawer-empty');
      const cartSubtotalValue = document.getElementById('cart-subtotal-value');

      // Show loading overlay
      showCartLoading();

      fetch('/cart.js')
        .then((response) => response.json())
        .then((cart) => {
          // Log the cart items to see their structure
          console.log('Cart contents:', cart);
          if (cart.items && cart.items.length > 0) {
            console.log('First cart item format:', cart.items[0]);
          }
          // Update subtotal
          if (cartSubtotalValue) {
            cartSubtotalValue.textContent = formatMoney(cart.total_price);
          }

          // Show/hide empty cart message
          if (cartItems && cartEmpty) {
            if (cart.item_count === 0) {
              cartItems.style.display = 'none';
              cartEmpty.style.display = 'flex';
            } else {
              cartItems.style.display = 'block';
              cartEmpty.style.display = 'none';

              // Render cart items
              cartItems.innerHTML = '';
              cart.items.forEach((item, index) => {
                // Add the index to the item object for reliable identification
                item.index = index;

                const itemElement = createCartItemElement(item);

                // If this is a new item and it's the first item in the cart
                // or if we're specifically flagging this as a new item, add animation
                if ((isNewItem && index === 0) || (cart.items.length === 1 && item.quantity === 1)) {
                  itemElement.classList.add('cart-drawer__add-animation');
                }

                cartItems.appendChild(itemElement);
              });
            }
          }

          // Hide loading overlay
          hideCartLoading();
        })
        .catch((error) => {
          console.error('Error fetching cart:', error);
          // Hide loading overlay even on error
          hideCartLoading();
        });
    }

    // Create cart item element
    function createCartItemElement(item) {
      // Log item details to see what we're working with
      console.log('Creating item element with data:', item);

      const itemDiv = document.createElement('div');
      itemDiv.className = 'cart-drawer__item';

      // Store the line item key as a data attribute for later use
      if (item.key) {
        itemDiv.setAttribute('data-item-key', item.key);
      }

      // Image
      const img = document.createElement('img');
      img.className = 'cart-drawer__item-image';

      // Try to get the featured image URL from the item
      if (item.featured_image) {
        img.src = item.featured_image.url;
      } else if (item.image) {
        img.src = item.image;
      } else {
        img.src = 'https://via.placeholder.com/80';
      }

      img.alt = item.title;

      // Details container
      const details = document.createElement('div');
      details.className = 'cart-drawer__item-details';

      // Title
      const title = document.createElement('div');
      title.className = 'cart-drawer__item-title';
      title.textContent = item.title;

      // Variant
      if (item.variant_title) {
        const variant = document.createElement('div');
        variant.className = 'cart-drawer__item-variant';
        variant.textContent = item.variant_title;
        details.appendChild(variant);
      }

      // Price
      const price = document.createElement('div');
      price.className = 'cart-drawer__item-price';
      price.textContent = formatMoney(item.price);

      // Quantity
      const quantity = document.createElement('div');
      quantity.className = 'cart-drawer__item-quantity';

      const minusBtn = document.createElement('button');
      minusBtn.className = 'cart-drawer__item-quantity-button';
      minusBtn.textContent = '-';
      // Try different ways to identify the item, prioritizing the most reliable
      // 1. Use line_item key if available (most reliable)
      // 2. Use zero-based index if we have it
      // 3. Fall back to variant ID
      let itemIdentifier;

      if (item.key) {
        itemIdentifier = item.key;
      } else if (typeof item.index !== 'undefined') {
        itemIdentifier = item.index;
      } else if (item.variant_id) {
        // If we have variant_id, use that with a special prefix
        itemIdentifier = `variant:${item.variant_id}`;
      } else {
        // Last resort
        itemIdentifier = item.id;
      }
      minusBtn.setAttribute('data-id', itemIdentifier);
      minusBtn.addEventListener('click', function () {
        updateItemQuantity(itemIdentifier, item.quantity - 1);
      });

      const qtyInput = document.createElement('input');
      qtyInput.className = 'cart-drawer__item-quantity-input';
      qtyInput.type = 'text';
      qtyInput.value = item.quantity;
      qtyInput.readOnly = true;

      const plusBtn = document.createElement('button');
      plusBtn.className = 'cart-drawer__item-quantity-button';
      plusBtn.textContent = '+';
      plusBtn.setAttribute('data-id', itemIdentifier);
      plusBtn.addEventListener('click', function () {
        updateItemQuantity(itemIdentifier, item.quantity + 1);
      });

      quantity.appendChild(minusBtn);
      quantity.appendChild(qtyInput);
      quantity.appendChild(plusBtn);

      // Remove button
      const removeBtn = document.createElement('button');
      removeBtn.className = 'cart-drawer__item-remove';
      removeBtn.setAttribute('data-id', itemIdentifier);
      removeBtn.addEventListener('click', function () {
        updateItemQuantity(itemIdentifier, 0);
      });

      // Add remove icon
      const removeIcon = document.createElement('span');
      removeIcon.className = 'cart-drawer__item-remove-icon';
      removeIcon.innerHTML = `<svg viewBox="0 0 24 24" width="12" height="12" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      </svg>`;

      removeBtn.appendChild(removeIcon);
      removeBtn.appendChild(document.createTextNode('Remove'));

      // Append all elements
      details.appendChild(title);
      details.appendChild(price);
      details.appendChild(quantity);
      details.appendChild(removeBtn);

      itemDiv.appendChild(img);
      itemDiv.appendChild(details);

      return itemDiv;
    }

    // Update item quantity
    function updateItemQuantity(id, quantity) {
      console.log('Updating item, ID format:', id, 'type:', typeof id);

      // Show loading overlay
      showCartLoading();

      // The API expects a few formats:
      // 1. Line item key (preferred) like: '43599a3726hjk34k55::shop.myshopify.com::1234567890'
      // 2. Variant ID as a string

      // Create the payload based on what we have
      let payload = { quantity: quantity };

      // For the Shopify Cart API in newer versions:
      // 1. If we have the line_item key - use it directly
      if (typeof id === 'string' && id.includes('::')) {
        payload.id = id;
      }
      // 2. Special case for variant ID with prefix
      else if (typeof id === 'string' && id.startsWith('variant:')) {
        payload.id = id.substring(8); // Remove the 'variant:' prefix
      }
      // 3. If we have a numeric index, use the line parameter instead
      else if (!isNaN(parseInt(id)) && String(parseInt(id)) === String(id)) {
        payload.line = parseInt(id) + 1; // Line items are 1-indexed in the API
      }
      // 4. Last resort - try using it as a variant ID
      else {
        payload.id = String(id);
      }

      console.log('Sending payload:', payload);

      fetch('/cart/change.js', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
      })
        .then((response) => {
          if (!response.ok) {
            // If response is not OK, try to parse error message
            return response.json().then((errorData) => {
              console.error('Cart update failed with status:', response.status, errorData);
              throw new Error(`Cart update failed: ${errorData.message || 'Unknown error'}`);
            });
          }
          return response.json();
        })
        .then((cart) => {
          // Successful update
          console.log('Cart updated successfully:', cart);
          updateCartCount();
          updateCartContents();
          // No need to hide loading here as updateCartContents will do it
        })
        .catch((error) => {
          console.error('Error updating cart:', error);
          // Refresh the cart anyway to ensure UI is in sync
          updateCartContents();
          // No need to hide loading here as updateCartContents will do it
        });
    }

    // Format money helper
    function formatMoney(cents) {
      const formatOptions = {
        style: 'currency',
        currency: Shopify.currency.active || 'USD',
      };
      return (cents / 100).toLocaleString(undefined, formatOptions);
    }

    // Listen for cart updates (using Shopify's cart change event)
    document.addEventListener('cart:refresh', handleCartUpdate);
    document.addEventListener('cart:change', handleCartUpdate);
    document.addEventListener('cart:updated', handleCartUpdate);

    // Combined handler for cart updates
    function handleCartUpdate(event) {
      updateCartCount();

      // If cart drawer is active, update its contents
      if (cartDrawer && cartDrawer.classList.contains('active')) {
        updateCartContents();
      }

      // If this was an add event, open the cart drawer
      if (event && event.detail && event.detail.source === 'product-form') {
        openCartDrawer(true);
      }
    }

    // Make cart drawer functions available globally
    window.openCartDrawer = openCartDrawer;
    window.closeCartDrawer = closeCartDrawer;

    // Also update on page load
    updateCartCount();

    // Function to update the cart count
    function updateCartCount() {
      fetch('/cart.js')
        .then((response) => response.json())
        .then((cart) => {
          const cartCountBubble = document.querySelector('.cart-count-bubble');
          const cartIconBubble = document.getElementById('cart-icon-bubble');

          if (cart.item_count > 0) {
            // If there's already a bubble, just update the count
            if (cartCountBubble) {
              const countSpan = cartCountBubble.querySelector('[aria-hidden="true"]');
              if (countSpan) {
                // Check if count changed
                if (countSpan.textContent != (cart.item_count < 100 ? cart.item_count : '99+')) {
                  countSpan.textContent = cart.item_count < 100 ? cart.item_count : '99+';

                  // Reset animation by removing and re-adding the class
                  cartCountBubble.style.animation = 'none';
                  setTimeout(() => {
                    cartCountBubble.style.animation = 'cart-bubble-pulse 0.5s ease-out';
                  }, 10);
                } else {
                  countSpan.textContent = cart.item_count < 100 ? cart.item_count : '99+';
                }
              }
            }
            // Otherwise create a new bubble
            else if (cartIconBubble) {
              const newBubble = document.createElement('div');
              newBubble.className = 'cart-count-bubble';

              const countSpan = document.createElement('span');
              countSpan.setAttribute('aria-hidden', 'true');
              countSpan.textContent = cart.item_count < 100 ? cart.item_count : '99+';

              const srSpan = document.createElement('span');
              srSpan.className = 'visually-hidden';
              srSpan.textContent = cart.item_count + ' items';

              newBubble.appendChild(countSpan);
              newBubble.appendChild(srSpan);
              cartIconBubble.appendChild(newBubble);
            }
          }
          // Remove bubble if cart is empty
          else if (cartCountBubble) {
            cartCountBubble.remove();
          }
        })
        .catch((error) => console.error('Error fetching cart:', error));
    }
  }
</script>

<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "Organization",
    "name": {{ shop.name | json }},
    {% if settings.logo %}
      "logo": {{ settings.logo | image_url: width: 500 | prepend: "https:" | json }},
    {% endif %}
    "sameAs": [
      {{ settings.social_twitter_link | json }},
      {{ settings.social_facebook_link | json }},
      {{ settings.social_pinterest_link | json }},
      {{ settings.social_instagram_link | json }},
      {{ settings.social_tiktok_link | json }},
      {{ settings.social_tumblr_link | json }},
      {{ settings.social_snapchat_link | json }},
      {{ settings.social_youtube_link | json }},
      {{ settings.social_vimeo_link | json }}
    ],
    "url": {{ request.origin | append: page.url | json }}
  }
</script>

{%- if request.page_type == 'index' -%}
  {% assign potential_action_target = request.origin | append: routes.search_url | append: '?q={search_term_string}' %}
  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "WebSite",
      "name": {{ shop.name | json }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": {{ potential_action_target | json }},
        "query-input": "required name=search_term_string"
      },
      "url": {{ request.origin | append: page.url | json }}
    }
  </script>
{%- endif -%}
